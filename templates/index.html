{% extends "base.html" %}

{% block title %}Fake News Detection - Home{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-4 text-primary">
                <i class="fas fa-shield-alt"></i> Fake News Detector
            </h1>
            <p class="lead text-muted">
                Analyze news articles using advanced Machine Learning algorithms to detect fake news
            </p>
        </div>

        <!-- Model Status Alert -->
        {% if not models_loaded %}
        <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Models not loaded!</strong> Please train the models first by running 
            <code>python fake_news_detection.py</code> or go to the 
            <a href="{{ url_for('train') }}" class="alert-link">Training page</a> for instructions.
        </div>
        {% endif %}

        <!-- Input Form -->
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title mb-0">
                    <i class="fas fa-edit"></i> Analyze News Article
                </h3>
            </div>
            <div class="card-body">
                <form id="predictionForm">
                    <!-- Model Selection -->
                    <div class="mb-4">
                        <label for="modelSelect" class="form-label">
                            <i class="fas fa-brain"></i> Choose ML Model
                        </label>
                        <select class="form-select" id="modelSelect" name="model">
                            {% for model in available_models %}
                            <option value="{{ model }}" {% if model == 'Logistic Regression' %}selected{% endif %}>
                                {{ model }}
                                {% if model_info.get(model) %}
                                - {{ model_info[model]['accuracy'] }} accuracy
                                {% endif %}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">
                            Different models have different strengths. Choose based on your needs.
                        </div>
                    </div>

                    <!-- Text Input -->
                    <div class="mb-4">
                        <label for="newsText" class="form-label">
                            <i class="fas fa-newspaper"></i> News Article Text
                        </label>
                        <textarea 
                            class="form-control" 
                            id="newsText" 
                            name="text" 
                            rows="8" 
                            placeholder="Paste your news article text here..."
                            required
                        ></textarea>
                        <div class="form-text">
                            Enter at least 10 characters. The more text, the better the analysis.
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" {% if not models_loaded %}disabled{% endif %}>
                            <i class="fas fa-search"></i> 
                            {% if models_loaded %}Analyze News{% else %}Train Models First{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center mt-4" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Analyzing...</span>
            </div>
            <p class="mt-2 text-muted">Analyzing your news article...</p>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="mt-4" style="display: none;">
            <div class="card shadow-lg">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-chart-line"></i> Analysis Results
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Prediction Result -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Prediction</h5>
                                    <div id="predictionResult" class="display-6 fw-bold">
                                        <!-- Result will be inserted here -->
                                    </div>
                                    <div id="confidenceLevel" class="text-muted">
                                        <!-- Confidence level will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h5 class="card-title">Confidence Scores</h5>
                                    <div id="confidenceScores">
                                        <!-- Confidence scores will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Information -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-0">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-info-circle"></i> Analysis Details
                                    </h6>
                                    <ul class="list-unstyled">
                                        <li><strong>Model Used:</strong> <span id="modelUsed"></span></li>
                                        <li><strong>Text Length:</strong> <span id="textLength"></span> characters</li>
                                        <li><strong>Word Count:</strong> <span id="wordCount"></span> words</li>
                                        <li><strong>Confidence Level:</strong> <span id="confidenceLevelText"></span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-microscope"></i> Model Information
                                    </h6>
                                    <div id="modelInfo">
                                        <!-- Model information will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="text-center mt-4">
                        <button class="btn btn-outline-primary me-2" onclick="analyzeAgain()">
                            <i class="fas fa-redo"></i> Analyze Another Article
                        </button>
                        <button class="btn btn-outline-secondary" onclick="shareResults()">
                            <i class="fas fa-share"></i> Share Results
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Articles -->
        <div class="card mt-5">
            <div class="card-header">
                <h4 class="card-title mb-0">
                    <i class="fas fa-lightbulb"></i> Try Sample Articles
                </h4>
            </div>
            <div class="card-body">
                <p class="text-muted">Click on any sample below to analyze it:</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">Real News Example</h6>
                            </div>
                            <div class="card-body">
                                <p class="card-text small">
                                    "Scientists at NASA have successfully launched a new Mars rover mission. 
                                    The rover, named Perseverance, will search for signs of ancient life on the red planet..."
                                </p>
                                <button class="btn btn-success btn-sm" onclick="loadSample('real')">
                                    <i class="fas fa-play"></i> Analyze This
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <h6 class="mb-0">Fake News Example</h6>
                            </div>
                            <div class="card-body">
                                <p class="card-text small">
                                    "BREAKING: Local man discovers that the government has been hiding aliens 
                                    in underground bases for decades! Sources say that reptilian overlords..."
                                </p>
                                <button class="btn btn-danger btn-sm" onclick="loadSample('fake')">
                                    <i class="fas fa-play"></i> Analyze This
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Sample articles
const sampleArticles = {
    real: "Scientists at NASA have successfully launched a new Mars rover mission. The rover, named Perseverance, will search for signs of ancient life on the red planet and collect rock samples for future return to Earth. The mission represents a major milestone in space exploration and will help scientists better understand Mars' geological history. The rover is equipped with advanced instruments including cameras, spectrometers, and a drill to analyze the Martian surface.",
    
    fake: "BREAKING: Local man discovers that the government has been hiding aliens in underground bases for decades! Sources say that reptilian overlords are controlling world leaders and the media is covering it up. This shocking revelation explains everything from climate change to the stock market fluctuations. The truth is finally coming out and the people deserve to know what's really happening behind closed doors!"
};

function loadSample(type) {
    document.getElementById('newsText').value = sampleArticles[type];
    document.getElementById('predictionForm').scrollIntoView({ behavior: 'smooth' });
}

function analyzeAgain() {
    document.getElementById('newsText').value = '';
    document.getElementById('resultsSection').style.display = 'none';
    document.getElementById('newsText').focus();
}

function shareResults() {
    if (navigator.share) {
        navigator.share({
            title: 'Fake News Detection Results',
            text: 'Check out this fake news detection analysis!',
            url: window.location.href
        });
    } else {
        // Fallback - copy to clipboard
        const resultText = `Fake News Detection Results:\n${document.getElementById('predictionResult').textContent}\nConfidence: ${document.getElementById('confidenceLevel').textContent}`;
        navigator.clipboard.writeText(resultText).then(() => {
            alert('Results copied to clipboard!');
        });
    }
}
</script>
{% endblock %}
